---
title: "Fiji earthquakes"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(crosstalk)
library(dplyr)

earthquake_classes <- c(Minor = 3, Light = 4, Moderate = 5,
  Strong = 6, Major = 7, Great = 8
)

quakes$class <- droplevels(factor(
  names(earthquake_classes)[match(trunc(quakes$mag), earthquake_classes)],
  unique(names(earthquake_classes)),
  ordered = TRUE))

set.seed(10101)
quakes <- quakes %>% sample_n(200)

sd <- SharedData$new(quakes)
```

Inputs {.sidebar}
-----------------------------------------------------------------------

```{r}
filter_slider("mag", "Magnitude", sd, ~mag)
filter_slider("depth", "Depth", sd, ~depth)
```

Column 1
-----------------------------------------------------------------------

### Map

```{r}
library(leaflet)
leaflet(sd) %>% addTiles() %>% addCircles(
  radius = ~mag * 10000, weight = 1, fillOpacity = 0.6,
  label = ~as.character(mag)
)
```

### Scatter

```{r}
library(d3scatter)
d3scatter(sd, x = ~depth, y = ~stations, color = ~class)
```

Column 2
-----------------------------------------------------------------------

### Table

```{r}
library(DT)
datatable(sd, rownames = FALSE, extensions = 'Scroller', options = list(
  scrollY = 200,
  scroller = TRUE
))
```
